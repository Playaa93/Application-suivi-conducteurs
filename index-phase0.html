<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Phase 0 - Identification & PrÃ©paratifs</title>
  <?!= HtmlService.createHtmlOutputFromFile('styles').getContent(); ?>
</head>
<body>
  <!-- Indicateurs de statut -->
  <div id="connectionStatus" class="offline-indicator online">ğŸŸ¢ En ligne</div>
  <div id="pendingIndicator" class="pending-indicator">ğŸ“¤ DonnÃ©es en attente</div>
  
  <!-- Bouton retour accueil -->
  <div class="home-button">
    <button class="btn-home" onclick="goToHome()" title="Retour Ã  l'accueil">
      ğŸ  Accueil
    </button>
  </div>
  
  <div class="form-container">
    <!-- En-tÃªte -->
    <div class="header">
      <h1>ğŸš€ Phase 0 : Identification & PrÃ©paratifs</h1>
      <div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" aria-label="Progression - Identification">
        <div class="progress-fill" style="width: 10%"></div>
      </div>
      <p class="phase-description">
        Connexion conducteur â€¢ Informations tournÃ©e â€¢ SÃ©lection vÃ©hicules
      </p>
    </div>
    
    <!-- Ã‰TAPE 1: Identification Conducteur -->
    <div class="step active" id="step1">
      <h2 class="step-title">ğŸ‘¤ Identification Conducteur</h2>
      
      <div class="info-box">
        <h3>ğŸ” Connexion SÃ©curisÃ©e</h3>
        <p>Saisissez votre code conducteur pour accÃ©der Ã  vos informations personnalisÃ©es.</p>
      </div>
      
      <div class="input-group">
        <label for="codeConducteur" class="required">Code Conducteur</label>
        <input type="number" id="codeConducteur" placeholder="Ex: 1001" required min="1000" max="9999">
        <small style="color: #666; font-size: 12px;">4 chiffres fournis par votre responsable</small>
      </div>
      
      <div class="navigation-buttons">
        <button class="btn btn-primary btn-large" onclick="connectConducteur()">
          ğŸ” Se Connecter
        </button>
      </div>
      
      <!-- Zone d'affichage des informations conducteur -->
      <div id="conducteurInfo" class="info-box" style="display: none;">
        <h3>âœ… Conducteur IdentifiÃ©</h3>
        <div id="conducteurDetails"></div>
      </div>
    </div>
    
    <!-- Ã‰TAPE 2: Informations TournÃ©e -->
    <div class="step" id="step2">
      <h2 class="step-title">ğŸ“… Informations TournÃ©e</h2>
      
      <div class="input-group">
        <label for="dateTournee" class="required">Date de la tournÃ©e</label>
        <input type="date" id="dateTournee" required>
        <small style="color: #666; font-size: 12px;">Date du jour par dÃ©faut</small>
      </div>
      
      <div class="input-group">
        <label for="heureDepartPrevue" class="required">Heure de dÃ©part prÃ©vue</label>
        <input type="time" id="heureDepartPrevue" required>
        <small style="color: #666; font-size: 12px;">Heure prÃ©vue de dÃ©part du site</small>
      </div>
      
      <div class="input-group">
        <label class="required">Type de tour</label>
        <div class="radio-group">
          <div class="radio-item">
            <input type="radio" id="tour1" name="typeTour" value="1er Tour" required>
            <label for="tour1">1er Tour</label>
          </div>
          <div class="radio-item">
            <input type="radio" id="tour2" name="typeTour" value="2Ã¨me Tour">
            <label for="tour2">2Ã¨me Tour</label>
          </div>
        </div>
      </div>
      
      <div class="input-group">
        <label class="required">Cycle de travail</label>
        <div class="radio-group">
          <div class="radio-item">
            <input type="radio" id="cycleJour" name="cycleTravail" value="Jour" required>
            <label for="cycleJour">Jour</label>
          </div>
          <div class="radio-item">
            <input type="radio" id="cycleNuit" name="cycleTravail" value="Nuit">
            <label for="cycleNuit">Nuit</label>
          </div>
        </div>
      </div>
      
      <div class="input-group">
        <label class="required">Type de livraison</label>
        <div class="radio-group">
          <div class="radio-item">
            <input type="radio" id="typeSec" name="typeLivraison" value="Sec" required>
            <label for="typeSec">Sec</label>
          </div>
          <div class="radio-item">
            <input type="radio" id="typeFrais" name="typeLivraison" value="Frais">
            <label for="typeFrais">Frais</label>
          </div>
          <div class="radio-item">
            <input type="radio" id="typeSurgele" name="typeLivraison" value="SurgelÃ©">
            <label for="typeSurgele">SurgelÃ©</label>
          </div>
        </div>
      </div>
      
      <div class="input-group">
        <label for="magasinsPrevu">Magasins prÃ©vus (optionnel)</label>
        <textarea id="magasinsPrevu" rows="3" placeholder="Ex: Magasin 1234, Magasin 5678, Ville XYZ..."></textarea>
        <small style="color: #666; font-size: 12px;">Liste ou description des magasins Ã  livrer</small>
      </div>
      
      <div class="navigation-buttons">
        <button class="btn btn-secondary" onclick="prevStep()">â† PrÃ©cÃ©dent</button>
        <button class="btn btn-primary" onclick="nextStep()">SÃ©lection VÃ©hicules â†’</button>
      </div>
    </div>
    
    <!-- Ã‰TAPE 3: SÃ©lection VÃ©hicules -->
    <div class="step" id="step3">
      <h2 class="step-title">ğŸš› SÃ©lection VÃ©hicules</h2>
      
      <div class="info-box">
        <h3>ğŸ¯ VÃ©hicules FiltrÃ©s</h3>
        <p>Les vÃ©hicules disponibles sont automatiquement filtrÃ©s selon votre site d'affectation et le type de livraison.</p>
      </div>
      
      <div class="input-group">
        <label for="tracteurSelect" class="required">Tracteur</label>
        <select id="tracteurSelect" required>
          <option value="">Chargement des tracteurs disponibles...</option>
        </select>
        <small style="color: #666; font-size: 12px;">Tracteurs disponibles pour votre site</small>
      </div>
      
      <div class="input-group">
        <label for="remorqueSelect" class="required">Remorque</label>
        <select id="remorqueSelect" required>
          <option value="">SÃ©lectionnez d'abord un tracteur...</option>
        </select>
        <small style="color: #666; font-size: 12px;">Remorques compatibles avec le type de livraison</small>
      </div>
      
      <!-- RÃ©sumÃ© de la sÃ©lection -->
      <div id="vehiculesSummary" class="summary-box" style="display: none;">
        <h3>ğŸ“‹ VÃ©hicules SÃ©lectionnÃ©s</h3>
        <div id="selectedVehicules"></div>
      </div>
      
      <div class="navigation-buttons">
        <button class="btn btn-secondary" onclick="prevStep()">â† PrÃ©cÃ©dent</button>
        <button class="btn btn-primary" onclick="nextStep()">RÃ©capitulatif â†’</button>
      </div>
    </div>
    
    <!-- Ã‰TAPE 4: RÃ©capitulatif et Validation -->
    <div class="step" id="step4">
      <h2 class="step-title">ğŸ“‹ RÃ©capitulatif Session</h2>
      
      <div class="summary-box">
        <h3>ğŸ‘¤ Conducteur</h3>
        <div id="summaryCondutreur"></div>
      </div>
      
      <div class="summary-box">
        <h3>ğŸ“… TournÃ©e</h3>
        <div id="summaryTournee"></div>
      </div>
      
      <div class="summary-box">
        <h3>ğŸš› VÃ©hicules</h3>
        <div id="summaryVehicules"></div>
      </div>
      
      <div class="info-box">
        <h3>ğŸš€ PrÃªt pour la Prise de Service</h3>
        <p>Toutes les informations de base sont complÃ©tÃ©es. Vous allez maintenant passer Ã  la Phase 1 : Prise de Service.</p>
        <p><strong>Session ID :</strong> <code id="generatedSessionId"></code></p>
      </div>
      
      <div class="navigation-buttons">
        <button class="btn btn-secondary" onclick="prevStep()">â† Modifier</button>
        <button class="btn btn-success btn-large" onclick="startPhase1()">
          ğŸš› Commencer la Prise de Service â†’
        </button>
      </div>
    </div>
  </div>

  <?!= HtmlService.createHtmlOutputFromFile('app-phase0').getContent(); ?>
</body>
</html>
